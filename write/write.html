<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vi·∫øt Th∆∞ | SecretLetter</title>

<link rel="stylesheet" href="write.css">
</head>

<body class="default">

<div class="background-blur"></div>

<div class="card">
<h1>Vi·∫øt m·ªôt l√° th∆∞ üíå</h1>

<form id="letterForm">

<div class="input-group">
<label>Ng∆∞·ªùi nh·∫≠n</label>
<input type="text" id="to" required maxlength="100">
</div>

<div class="input-group">
<label>Ch·ªß ƒë·ªÅ</label>
<input type="text" id="subject" maxlength="150">
</div>

<div class="input-group">
<label>N·ªôi dung</label>

<div class="toolbar">
<button type="button" onclick="format('bold')"><b>B</b></button>
<button type="button" onclick="format('italic')"><i>I</i></button>
<button type="button" onclick="format('underline')"><u>U</u></button>

<select id="fontSelect">
<option value="">Font ƒëo·∫°n</option>
<option value="'Great Vibes'">Great Vibes</option>
<option value="'Pacifico'">Pacifico</option>
<option value="'Montserrat'">Montserrat</option>
<option value="'Caveat'">Caveat</option>
</select>

<input type="color" id="colorPicker">
</div>

<div id="editor" contenteditable="true" class="editor"></div>
<span id="charCount">0 / 2000</span>
</div>

<div class="row">
<div class="input-group half">
<label>M·∫≠t kh·∫©u (tu·ª≥ ch·ªçn)</label>
<input type="password" id="password">
</div>

<div class="input-group half">
<label>Th·ªùi h·∫°n</label>
<select id="expiry">
<option value="1">1 ng√†y</option>
<option value="7" selected>7 ng√†y</option>
<option value="30">30 ng√†y</option>
<option value="0">Vƒ©nh vi·ªÖn</option>
</select>
</div>
</div>

<!-- STYLE PANEL -->
<div class="style-panel">
<h3>Tu·ª≥ ch·ªânh phong c√°ch ‚ú®</h3>

<div class="input-group">
<label>Theme</label>
<select id="theme">
<option value="default">Default</option>
<option value="romantic">Romantic</option>
<option value="loving">Loving</option>
<option value="cute">Cute</option>
<option value="dracula">Dracula</option>
<option value="sunset">Sunset</option>
<option value="ocean">Ocean</option>
</select>
</div>
</div>

<button type="submit">T·∫°o th∆∞</button>

</form>
</div>

<script type="module">

/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSy...",
authDomain: "screctletters.firebaseapp.com",
projectId: "screctletters",
storageBucket: "screctletters.firebasestorage.app",
messagingSenderId: "916940604225",
appId: "1:916940604225:web:faf88856504271362ed7c0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================= EDITOR ================= */

window.format = function(cmd){
document.execCommand(cmd, false, null);
};

document.getElementById("fontSelect").addEventListener("change", function(){
document.execCommand("fontName", false, this.value);
});

document.getElementById("colorPicker").addEventListener("input", function(){
document.execCommand("foreColor", false, this.value);
});

const editor = document.getElementById("editor");
const charCount = document.getElementById("charCount");

editor.addEventListener("input", function(){
let length = editor.innerText.length;
charCount.textContent = length + " / 2000";
});

/* ================= THEME ================= */

const themes = ["default","romantic","loving","cute","dracula","sunset","ocean"];

document.getElementById("theme").addEventListener("change", function(){
themes.forEach(t => document.body.classList.remove(t));
document.body.classList.add(this.value);
});

/* ================= FORM SUBMIT ================= */

document.getElementById("letterForm").addEventListener("submit", async function(e){
e.preventDefault();

const id = Math.random().toString(36).substring(2,10);

await setDoc(doc(db,"letters",id),{
to: document.getElementById("to").value,
subject: document.getElementById("subject").value,
content: editor.innerHTML,
password: document.getElementById("password").value,
expiry: document.getElementById("expiry").value,
createdAt: Date.now()
});

alert("T·∫°o th∆∞ th√†nh c√¥ng!");
});

</script>

</body>
</html>